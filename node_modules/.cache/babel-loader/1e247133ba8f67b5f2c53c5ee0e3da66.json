{"ast":null,"code":"import _classCallCheck from\"/Users/nexle-user/Documents/dr-web-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/nexle-user/Documents/dr-web-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/nexle-user/Documents/dr-web-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/nexle-user/Documents/dr-web-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import moment from'moment';import React,{Component}from'react';import ReactLoading from'react-loading';import{myStorage,myFirestore}from'../../lib/firebase';import images from'../Themes/Images';import'./ChatBoard.css';import'../Main/Main.css';import{AppString,supportInfo}from'./../ChatBox/Const';var ChatBoard=/*#__PURE__*/function(_Component){_inherits(ChatBoard,_Component);var _super=_createSuper(ChatBoard);function ChatBoard(props){var _this;_classCallCheck(this,ChatBoard);_this=_super.call(this,props);_this.getListHistory=function(){if(_this.removeListener){_this.removeListener();}_this.listMessage.length=0;_this.setState({isLoading:true});if(_this.hashString(_this.currentUserId)<=_this.hashString(_this.currentPeerUser.id)){_this.groupChatId=\"\".concat(_this.currentUserId,\"-\").concat(_this.currentPeerUser.id);}else{_this.groupChatId=\"\".concat(_this.currentPeerUser.id,\"-\").concat(_this.currentUserId);}// Get history and listen new data added\n_this.removeListener=myFirestore.collection(AppString.NODE_MESSAGES).doc(_this.groupChatId).collection(_this.groupChatId).onSnapshot(function(snapshot){snapshot.docChanges().forEach(function(change){if(change.type===AppString.DOC_ADDED){_this.listMessage.push(change.doc.data());}});_this.setState({isLoading:false});},function(err){_this.props.showToast(0,err.toString());});};_this.openListSticker=function(){_this.setState({isShowSticker:!_this.state.isShowSticker});};_this.onSendMessage=function(content,type){if(_this.state.isShowSticker&&type===2){_this.setState({isShowSticker:false});}if(content.trim()===''){return;}var timestamp=moment().valueOf().toString();var itemMessage={idFrom:_this.currentUserId,idTo:_this.currentPeerUser.id,timestamp:timestamp,content:content.trim(),type:type};myFirestore.collection(AppString.NODE_MESSAGES).doc(_this.groupChatId).collection(_this.groupChatId).doc(timestamp).set(itemMessage).then(function(){_this.setState({inputValue:''});}).catch(function(err){_this.props.showToast(0,err.toString());});};_this.onChoosePhoto=function(event){if(event.target.files&&event.target.files[0]){_this.setState({isLoading:true});_this.currentPhotoFile=event.target.files[0];// Check this file is an image?\nvar prefixFiletype=event.target.files[0].type.toString();if(prefixFiletype.indexOf(AppString.PREFIX_IMAGE)===0){_this.uploadPhoto();}else{_this.setState({isLoading:false});_this.props.showToast(0,'This file is not an image');}}else{_this.setState({isLoading:false});}};_this.uploadPhoto=function(){if(_this.currentPhotoFile){var timestamp=moment().valueOf().toString();var uploadTask=myStorage.ref().child(timestamp).put(_this.currentPhotoFile);uploadTask.on(AppString.UPLOAD_CHANGED,null,function(err){_this.setState({isLoading:false});_this.props.showToast(0,err.message);},function(){uploadTask.snapshot.ref.getDownloadURL().then(function(downloadURL){_this.setState({isLoading:false});_this.onSendMessage(downloadURL,1);});});}else{_this.setState({isLoading:false});_this.props.showToast(0,'File is null');}};_this.onKeyboardPress=function(event){if(event.key==='Enter'){_this.onSendMessage(_this.state.inputValue,0);}};_this.scrollToBottom=function(){if(_this.messagesEnd){_this.messagesEnd.scrollIntoView({});}};_this.renderListMessage=function(){if(_this.listMessage.length>0){var viewListMessage=[];_this.listMessage.forEach(function(item,index){if(item.idFrom===_this.currentUserId){// Item right (my message)\nif(item.type===0){viewListMessage.push(/*#__PURE__*/React.createElement(\"div\",{className:\"viewItemRight\",key:item.timestamp},/*#__PURE__*/React.createElement(\"span\",{className:\"textContentItem\"},item.content)));}else if(item.type===1){viewListMessage.push(/*#__PURE__*/React.createElement(\"div\",{className:\"viewItemRight2\",key:item.timestamp},/*#__PURE__*/React.createElement(\"img\",{className:\"imgItemRight\",src:item.content,alt:\"content message\"})));}else{viewListMessage.push(/*#__PURE__*/React.createElement(\"div\",{className:\"viewItemRight3\",key:item.timestamp},/*#__PURE__*/React.createElement(\"img\",{className:\"imgItemRight\",src:_this.getGifImage(item.content),alt:\"content message\"})));}}else{// Item left (peer message)\nif(item.type===0){viewListMessage.push(/*#__PURE__*/React.createElement(\"div\",{className:\"viewWrapItemLeft\",key:item.timestamp},/*#__PURE__*/React.createElement(\"div\",{className:\"viewWrapItemLeft3\"},_this.isLastMessageLeft(index)?/*#__PURE__*/React.createElement(\"img\",{src:_this.currentPeerUser.photoUrl&&_this.currentPeerUser.photoUrl!==''?_this.currentPeerUser.photoUrl:'/assets/img/avatar.png',alt:\"avatar\",className:\"peerAvatarLeft\"}):/*#__PURE__*/React.createElement(\"div\",{className:\"viewPaddingLeft\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"viewItemLeft\"},/*#__PURE__*/React.createElement(\"span\",{className:\"textContentItem\"},item.content))),_this.isLastMessageLeft(index)?/*#__PURE__*/React.createElement(\"span\",{className:\"textTimeLeft\"},moment(Number(item.timestamp)).format('ll')):null));}else if(item.type===1){viewListMessage.push(/*#__PURE__*/React.createElement(\"div\",{className:\"viewWrapItemLeft2\",key:item.timestamp},/*#__PURE__*/React.createElement(\"div\",{className:\"viewWrapItemLeft3\"},_this.isLastMessageLeft(index)?/*#__PURE__*/React.createElement(\"img\",{src:_this.currentPeerUser.photoUrl&&_this.currentPeerUser.photoUrl!==''?_this.currentPeerUser.photoUrl:'/assets/img/avatar.png',alt:\"avatar\",className:\"peerAvatarLeft\"}):/*#__PURE__*/React.createElement(\"div\",{className:\"viewPaddingLeft\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"viewItemLeft2\"},/*#__PURE__*/React.createElement(\"img\",{className:\"imgItemLeft\",src:item.content,alt:\"content message\"}))),_this.isLastMessageLeft(index)?/*#__PURE__*/React.createElement(\"span\",{className:\"textTimeLeft\"},moment(Number(item.timestamp)).format('ll')):null));}else{viewListMessage.push(/*#__PURE__*/React.createElement(\"div\",{className:\"viewWrapItemLeft2\",key:item.timestamp},/*#__PURE__*/React.createElement(\"div\",{className:\"viewWrapItemLeft3\"},_this.isLastMessageLeft(index)?/*#__PURE__*/React.createElement(\"img\",{src:_this.currentPeerUser.photoUrl&&_this.currentPeerUser.photoUrl!==''?_this.currentPeerUser.photoUrl:'/assets/img/avatar.png',alt:\"avatar\",className:\"peerAvatarLeft\"}):/*#__PURE__*/React.createElement(\"div\",{className:\"viewPaddingLeft\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"viewItemLeft3\",key:item.timestamp},/*#__PURE__*/React.createElement(\"img\",{className:\"imgItemLeft\",src:_this.getGifImage(item.content),alt:\"content message\"}))),_this.isLastMessageLeft(index)?/*#__PURE__*/React.createElement(\"span\",{className:\"textTimeLeft\"},moment(Number(item.timestamp)).format('ll')):null));}}});return viewListMessage;}else{return/*#__PURE__*/React.createElement(\"div\",{className:\"viewWrapSayHi\"},/*#__PURE__*/React.createElement(\"span\",{className:\"textSayHi\"},\"Ask somthing for supporter ?\"),/*#__PURE__*/React.createElement(\"img\",{className:\"imgWaveHand\",src:images.ic_wave_hand,alt:\"wave hand\"}));}};_this.renderStickers=function(){return/*#__PURE__*/React.createElement(\"div\",{className:\"viewStickers\"},/*#__PURE__*/React.createElement(\"img\",{className:\"imgSticker\",src:images.mimi1,alt:\"sticker\",onClick:function onClick(){return _this.onSendMessage('mimi1',2);}}),/*#__PURE__*/React.createElement(\"img\",{className:\"imgSticker\",src:images.mimi2,alt:\"sticker\",onClick:function onClick(){return _this.onSendMessage('mimi2',2);}}),/*#__PURE__*/React.createElement(\"img\",{className:\"imgSticker\",src:images.mimi3,alt:\"sticker\",onClick:function onClick(){return _this.onSendMessage('mimi3',2);}}),/*#__PURE__*/React.createElement(\"img\",{className:\"imgSticker\",src:images.mimi4,alt:\"sticker\",onClick:function onClick(){return _this.onSendMessage('mimi4',2);}}),/*#__PURE__*/React.createElement(\"img\",{className:\"imgSticker\",src:images.mimi5,alt:\"sticker\",onClick:function onClick(){return _this.onSendMessage('mimi5',2);}}),/*#__PURE__*/React.createElement(\"img\",{className:\"imgSticker\",src:images.mimi6,alt:\"sticker\",onClick:function onClick(){return _this.onSendMessage('mimi6',2);}}),/*#__PURE__*/React.createElement(\"img\",{className:\"imgSticker\",src:images.mimi7,alt:\"sticker\",onClick:function onClick(){return _this.onSendMessage('mimi7',2);}}),/*#__PURE__*/React.createElement(\"img\",{className:\"imgSticker\",src:images.mimi8,alt:\"sticker\",onClick:function onClick(){return _this.onSendMessage('mimi8',2);}}),/*#__PURE__*/React.createElement(\"img\",{className:\"imgSticker\",src:images.mimi9,alt:\"sticker\",onClick:function onClick(){return _this.onSendMessage('mimi9',2);}}));};_this.hashString=function(str){var hash=0;for(var i=0;i<str.length;i++){hash+=Math.pow(str.charCodeAt(i)*31,str.length-i);hash=hash&hash;// Convert to 32bit integer\n}return hash;};_this.getGifImage=function(value){switch(value){case'mimi1':return images.mimi1;case'mimi2':return images.mimi2;case'mimi3':return images.mimi3;case'mimi4':return images.mimi4;case'mimi5':return images.mimi5;case'mimi6':return images.mimi6;case'mimi7':return images.mimi7;case'mimi8':return images.mimi8;case'mimi9':return images.mimi9;default:return null;}};_this.state={isLoading:false,isShowSticker:false,inputValue:''};_this.currentUserId=supportInfo.id;_this.currentUserAvatar=supportInfo.photoUrl;_this.currentUserNickname=supportInfo.nickName;_this.listMessage=[];_this.currentPeerUser=_this.props.currentPeerUser;_this.groupChatId=null;_this.removeListener=null;_this.currentPhotoFile=null;return _this;}_createClass(ChatBoard,[{key:\"componentDidUpdate\",value:function componentDidUpdate(){this.scrollToBottom();}},{key:\"componentDidMount\",value:function componentDidMount(){// For first render, it's not go through componentWillReceiveProps\nthis.getListHistory();}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){if(this.removeListener){this.removeListener();}}},{key:\"componentWillReceiveProps\",value:function componentWillReceiveProps(newProps){if(newProps.currentPeerUser){this.currentPeerUser=newProps.currentPeerUser;this.getListHistory();}}},{key:\"render\",value:function render(){var _this2=this;return/*#__PURE__*/React.createElement(\"div\",{className:\"viewChatBoard\"},/*#__PURE__*/React.createElement(\"div\",{className:\"headerChatBoard\"},/*#__PURE__*/React.createElement(\"div\",{className:\"viewAvatarItem viewAvatarItem-Second\",style:{backgroundColor:this.currentPeerUser.color||'black'}},this.currentPeerUser.nickname.toUpperCase().substring(0,1)),/*#__PURE__*/React.createElement(\"span\",{className:\"textHeaderChatBoard\"},this.currentPeerUser.nickname)),/*#__PURE__*/React.createElement(\"div\",{className:\"viewListContentChat\"},this.renderListMessage(),/*#__PURE__*/React.createElement(\"div\",{style:{float:'left',clear:'both'},ref:function ref(el){_this2.messagesEnd=el;}})),this.state.isShowSticker?this.renderStickers():null,/*#__PURE__*/React.createElement(\"div\",{className:\"viewBottom\"},/*#__PURE__*/React.createElement(\"img\",{className:\"icOpenGallery\",src:images.ic_photo,alt:\"icon open gallery\",onClick:function onClick(){return _this2.refInput.click();}}),/*#__PURE__*/React.createElement(\"input\",{ref:function ref(el){_this2.refInput=el;},accept:\"image/*\",className:\"viewInputGallery\",type:\"file\",onChange:this.onChoosePhoto}),/*#__PURE__*/React.createElement(\"img\",{className:\"icOpenSticker\",src:images.ic_sticker,alt:\"icon open sticker\",onClick:this.openListSticker}),/*#__PURE__*/React.createElement(\"input\",{className:\"viewInput\",placeholder:\"Type your message...\",value:this.state.inputValue,onChange:function onChange(event){_this2.setState({inputValue:event.target.value});},onKeyPress:this.onKeyboardPress}),/*#__PURE__*/React.createElement(\"img\",{className:\"icSend\",src:images.ic_send,alt:\"icon send\",onClick:function onClick(){return _this2.onSendMessage(_this2.state.inputValue,0);}})),this.state.isLoading?/*#__PURE__*/React.createElement(\"div\",{className:\"viewLoading\"},/*#__PURE__*/React.createElement(ReactLoading,{type:'spin',color:'#203152',height:'3%',width:'3%'})):null);}},{key:\"isLastMessageLeft\",value:function isLastMessageLeft(index){if(index+1<this.listMessage.length&&this.listMessage[index+1].idFrom===this.currentUserId||index===this.listMessage.length-1){return true;}else{return false;}}},{key:\"isLastMessageRight\",value:function isLastMessageRight(index){if(index+1<this.listMessage.length&&this.listMessage[index+1].idFrom!==this.currentUserId||index===this.listMessage.length-1){return true;}else{return false;}}}]);return ChatBoard;}(Component);export{ChatBoard as default};","map":{"version":3,"sources":["/Users/nexle-user/Documents/dr-web-react/src/components/ChatBoard/ChatBoard.js"],"names":["moment","React","Component","ReactLoading","myStorage","myFirestore","images","AppString","supportInfo","ChatBoard","props","getListHistory","removeListener","listMessage","length","setState","isLoading","hashString","currentUserId","currentPeerUser","id","groupChatId","collection","NODE_MESSAGES","doc","onSnapshot","snapshot","docChanges","forEach","change","type","DOC_ADDED","push","data","err","showToast","toString","openListSticker","isShowSticker","state","onSendMessage","content","trim","timestamp","valueOf","itemMessage","idFrom","idTo","set","then","inputValue","catch","onChoosePhoto","event","target","files","currentPhotoFile","prefixFiletype","indexOf","PREFIX_IMAGE","uploadPhoto","uploadTask","ref","child","put","on","UPLOAD_CHANGED","message","getDownloadURL","downloadURL","onKeyboardPress","key","scrollToBottom","messagesEnd","scrollIntoView","renderListMessage","viewListMessage","item","index","getGifImage","isLastMessageLeft","photoUrl","Number","format","ic_wave_hand","renderStickers","mimi1","mimi2","mimi3","mimi4","mimi5","mimi6","mimi7","mimi8","mimi9","str","hash","i","Math","pow","charCodeAt","value","currentUserAvatar","currentUserNickname","nickName","newProps","backgroundColor","color","nickname","toUpperCase","substring","float","clear","el","ic_photo","refInput","click","ic_sticker","ic_send"],"mappings":"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","sourcesContent":["import moment from 'moment'\nimport React, { Component } from 'react'\nimport ReactLoading from 'react-loading'\nimport { myStorage, myFirestore } from '../../lib/firebase'\nimport images from '../Themes/Images'\nimport './ChatBoard.css'\nimport '../Main/Main.css'\nimport { AppString, supportInfo } from './../ChatBox/Const'\n\nexport default class ChatBoard extends Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      isLoading: false,\n      isShowSticker: false,\n      inputValue: ''\n    }\n    this.currentUserId = supportInfo.id\n    this.currentUserAvatar = supportInfo.photoUrl\n    this.currentUserNickname = supportInfo.nickName\n    this.listMessage = []\n    this.currentPeerUser = this.props.currentPeerUser\n    this.groupChatId = null\n    this.removeListener = null\n    this.currentPhotoFile = null\n  }\n\n  componentDidUpdate() {\n    this.scrollToBottom()\n  }\n\n  componentDidMount() {\n    // For first render, it's not go through componentWillReceiveProps\n    this.getListHistory()\n  }\n\n  componentWillUnmount() {\n    if (this.removeListener) {\n      this.removeListener()\n    }\n  }\n\n  componentWillReceiveProps(newProps) {\n    if (newProps.currentPeerUser) {\n      this.currentPeerUser = newProps.currentPeerUser\n      this.getListHistory()\n    }\n  }\n\n  getListHistory = () => {\n    if (this.removeListener) {\n      this.removeListener()\n    }\n    this.listMessage.length = 0\n    this.setState({ isLoading: true })\n    if (\n      this.hashString(this.currentUserId) <=\n      this.hashString(this.currentPeerUser.id)\n    ) {\n      this.groupChatId = `${this.currentUserId}-${this.currentPeerUser.id}`\n    } else {\n      this.groupChatId = `${this.currentPeerUser.id}-${this.currentUserId}`\n    }\n\n    // Get history and listen new data added\n    this.removeListener = myFirestore\n      .collection(AppString.NODE_MESSAGES)\n      .doc(this.groupChatId)\n      .collection(this.groupChatId)\n      .onSnapshot(\n        snapshot => {\n          snapshot.docChanges().forEach(change => {\n            if (change.type === AppString.DOC_ADDED) {\n              this.listMessage.push(change.doc.data())\n            }\n          })\n          this.setState({ isLoading: false })\n        },\n        err => {\n          this.props.showToast(0, err.toString())\n        }\n      )\n  }\n\n  openListSticker = () => {\n    this.setState({ isShowSticker: !this.state.isShowSticker })\n  }\n\n  onSendMessage = (content, type) => {\n    if (this.state.isShowSticker && type === 2) {\n      this.setState({ isShowSticker: false })\n    }\n\n    if (content.trim() === '') {\n      return\n    }\n\n    const timestamp = moment()\n      .valueOf()\n      .toString()\n\n    const itemMessage = {\n      idFrom: this.currentUserId,\n      idTo: this.currentPeerUser.id,\n      timestamp: timestamp,\n      content: content.trim(),\n      type: type\n    }\n\n    myFirestore\n      .collection(AppString.NODE_MESSAGES)\n      .doc(this.groupChatId)\n      .collection(this.groupChatId)\n      .doc(timestamp)\n      .set(itemMessage)\n      .then(() => {\n        this.setState({ inputValue: '' })\n      })\n      .catch(err => {\n        this.props.showToast(0, err.toString())\n      })\n  }\n\n  onChoosePhoto = event => {\n    if (event.target.files && event.target.files[0]) {\n      this.setState({ isLoading: true })\n      this.currentPhotoFile = event.target.files[0]\n      // Check this file is an image?\n      const prefixFiletype = event.target.files[0].type.toString()\n      if (prefixFiletype.indexOf(AppString.PREFIX_IMAGE) === 0) {\n        this.uploadPhoto()\n      } else {\n        this.setState({ isLoading: false })\n        this.props.showToast(0, 'This file is not an image')\n      }\n    } else {\n      this.setState({ isLoading: false })\n    }\n  }\n\n  uploadPhoto = () => {\n    if (this.currentPhotoFile) {\n      const timestamp = moment()\n        .valueOf()\n        .toString()\n\n      const uploadTask = myStorage\n        .ref()\n        .child(timestamp)\n        .put(this.currentPhotoFile)\n\n      uploadTask.on(\n        AppString.UPLOAD_CHANGED,\n        null,\n        err => {\n          this.setState({ isLoading: false })\n          this.props.showToast(0, err.message)\n        },\n        () => {\n          uploadTask.snapshot.ref.getDownloadURL().then(downloadURL => {\n            this.setState({ isLoading: false })\n            this.onSendMessage(downloadURL, 1)\n          })\n        }\n      )\n    } else {\n      this.setState({ isLoading: false })\n      this.props.showToast(0, 'File is null')\n    }\n  }\n\n  onKeyboardPress = event => {\n    if (event.key === 'Enter') {\n      this.onSendMessage(this.state.inputValue, 0)\n    }\n  }\n\n  scrollToBottom = () => {\n    if (this.messagesEnd) {\n      this.messagesEnd.scrollIntoView({})\n    }\n  }\n\n  render() {\n    return (\n      <div className=\"viewChatBoard\">\n        {/* Header */}\n        <div className=\"headerChatBoard\">\n          <div\n            className=\"viewAvatarItem viewAvatarItem-Second\"\n            style={{ backgroundColor: this.currentPeerUser.color || 'black' }}\n\n\n          >\n            {this.currentPeerUser.nickname.toUpperCase().substring(0, 1)}\n          </div>\n          <span className=\"textHeaderChatBoard\">\n            {this.currentPeerUser.nickname}\n          </span>\n        </div>\n\n        {/* List message */}\n        <div className=\"viewListContentChat\">\n          {this.renderListMessage()}\n          <div\n            style={{ float: 'left', clear: 'both' }}\n            ref={el => {\n              this.messagesEnd = el\n            }}\n          />\n        </div>\n\n        {/* Stickers */}\n        {this.state.isShowSticker ? this.renderStickers() : null}\n\n        {/* View bottom */}\n        <div className=\"viewBottom\">\n          <img\n            className=\"icOpenGallery\"\n            src={images.ic_photo}\n            alt=\"icon open gallery\"\n            onClick={() => this.refInput.click()}\n          />\n\n          <input\n            ref={el => {\n              this.refInput = el\n            }}\n            accept=\"image/*\"\n            className=\"viewInputGallery\"\n            type=\"file\"\n            onChange={this.onChoosePhoto}\n          />\n\n          <img\n            className=\"icOpenSticker\"\n            src={images.ic_sticker}\n            alt=\"icon open sticker\"\n            onClick={this.openListSticker}\n          />\n\n          <input\n            className=\"viewInput\"\n            placeholder=\"Type your message...\"\n            value={this.state.inputValue}\n            onChange={event => {\n              this.setState({ inputValue: event.target.value })\n            }}\n            onKeyPress={this.onKeyboardPress}\n          />\n          <img\n            className=\"icSend\"\n            src={images.ic_send}\n            alt=\"icon send\"\n            onClick={() => this.onSendMessage(this.state.inputValue, 0)}\n          />\n        </div>\n\n        {/* Loading */}\n        {this.state.isLoading ? (\n          <div className=\"viewLoading\">\n            <ReactLoading\n              type={'spin'}\n              color={'#203152'}\n              height={'3%'}\n              width={'3%'}\n            />\n          </div>\n        ) : null}\n      </div>\n    )\n  }\n\n  renderListMessage = () => {\n    if (this.listMessage.length > 0) {\n      let viewListMessage = []\n      this.listMessage.forEach((item, index) => {\n        if (item.idFrom === this.currentUserId) {\n          // Item right (my message)\n          if (item.type === 0) {\n            viewListMessage.push(\n              <div className=\"viewItemRight\" key={item.timestamp}>\n                <span className=\"textContentItem\">{item.content}</span>\n              </div>\n            )\n          } else if (item.type === 1) {\n            viewListMessage.push(\n              <div className=\"viewItemRight2\" key={item.timestamp}>\n                <img\n                  className=\"imgItemRight\"\n                  src={item.content}\n                  alt=\"content message\"\n                />\n              </div>\n            )\n          } else {\n            viewListMessage.push(\n              <div className=\"viewItemRight3\" key={item.timestamp}>\n                <img\n                  className=\"imgItemRight\"\n                  src={this.getGifImage(item.content)}\n                  alt=\"content message\"\n                />\n              </div>\n            )\n          }\n        } else {\n          // Item left (peer message)\n          if (item.type === 0) {\n            viewListMessage.push(\n              <div className=\"viewWrapItemLeft\" key={item.timestamp}>\n                <div className=\"viewWrapItemLeft3\">\n                  {this.isLastMessageLeft(index) ? (\n                    <img\n                      src={this.currentPeerUser.photoUrl && this.currentPeerUser.photoUrl !== '' ? this.currentPeerUser.photoUrl : '/assets/img/avatar.png'}\n                      alt=\"avatar\"\n                      className=\"peerAvatarLeft\"\n                    />\n                  ) : (\n                      <div className=\"viewPaddingLeft\" />\n                    )}\n                  <div className=\"viewItemLeft\">\n                    <span className=\"textContentItem\">{item.content}</span>\n                  </div>\n                </div>\n                {this.isLastMessageLeft(index) ? (\n                  <span className=\"textTimeLeft\">\n                    {moment(Number(item.timestamp)).format('ll')}\n                  </span>\n                ) : null}\n              </div>\n            )\n          } else if (item.type === 1) {\n            viewListMessage.push(\n              <div className=\"viewWrapItemLeft2\" key={item.timestamp}>\n                <div className=\"viewWrapItemLeft3\">\n                  {this.isLastMessageLeft(index) ? (\n                    <img\n                      src={this.currentPeerUser.photoUrl && this.currentPeerUser.photoUrl !== '' ? this.currentPeerUser.photoUrl : '/assets/img/avatar.png'}\n                      alt=\"avatar\"\n                      className=\"peerAvatarLeft\"\n                    />\n                  ) : (\n                      <div className=\"viewPaddingLeft\" />\n                    )}\n                  <div className=\"viewItemLeft2\">\n                    <img\n                      className=\"imgItemLeft\"\n                      src={item.content}\n                      alt=\"content message\"\n                    />\n                  </div>\n                </div>\n                {this.isLastMessageLeft(index) ? (\n                  <span className=\"textTimeLeft\">\n                    {moment(Number(item.timestamp)).format('ll')}\n                  </span>\n                ) : null}\n              </div>\n            )\n          } else {\n            viewListMessage.push(\n              <div className=\"viewWrapItemLeft2\" key={item.timestamp}>\n                <div className=\"viewWrapItemLeft3\">\n                  {this.isLastMessageLeft(index) ? (\n                    <img\n                      src={this.currentPeerUser.photoUrl && this.currentPeerUser.photoUrl !== '' ? this.currentPeerUser.photoUrl : '/assets/img/avatar.png'}\n                      alt=\"avatar\"\n                      className=\"peerAvatarLeft\"\n                    />\n                  ) : (\n                      <div className=\"viewPaddingLeft\" />\n                    )}\n                  <div className=\"viewItemLeft3\" key={item.timestamp}>\n                    <img\n                      className=\"imgItemLeft\"\n                      src={this.getGifImage(item.content)}\n                      alt=\"content message\"\n                    />\n                  </div>\n                </div>\n                {this.isLastMessageLeft(index) ? (\n                  <span className=\"textTimeLeft\">\n                    {moment(Number(item.timestamp)).format('ll')}\n                  </span>\n                ) : null}\n              </div>\n            )\n          }\n        }\n      })\n      return viewListMessage\n    } else {\n      return (\n        <div className=\"viewWrapSayHi\">\n          <span className=\"textSayHi\">Ask somthing for supporter ?</span>\n          <img\n            className=\"imgWaveHand\"\n            src={images.ic_wave_hand}\n            alt=\"wave hand\"\n          />\n        </div>\n      )\n    }\n  }\n\n  renderStickers = () => {\n    return (\n      <div className=\"viewStickers\">\n        <img\n          className=\"imgSticker\"\n          src={images.mimi1}\n          alt=\"sticker\"\n          onClick={() => this.onSendMessage('mimi1', 2)}\n        />\n        <img\n          className=\"imgSticker\"\n          src={images.mimi2}\n          alt=\"sticker\"\n          onClick={() => this.onSendMessage('mimi2', 2)}\n        />\n        <img\n          className=\"imgSticker\"\n          src={images.mimi3}\n          alt=\"sticker\"\n          onClick={() => this.onSendMessage('mimi3', 2)}\n        />\n        <img\n          className=\"imgSticker\"\n          src={images.mimi4}\n          alt=\"sticker\"\n          onClick={() => this.onSendMessage('mimi4', 2)}\n        />\n        <img\n          className=\"imgSticker\"\n          src={images.mimi5}\n          alt=\"sticker\"\n          onClick={() => this.onSendMessage('mimi5', 2)}\n        />\n        <img\n          className=\"imgSticker\"\n          src={images.mimi6}\n          alt=\"sticker\"\n          onClick={() => this.onSendMessage('mimi6', 2)}\n        />\n        <img\n          className=\"imgSticker\"\n          src={images.mimi7}\n          alt=\"sticker\"\n          onClick={() => this.onSendMessage('mimi7', 2)}\n        />\n        <img\n          className=\"imgSticker\"\n          src={images.mimi8}\n          alt=\"sticker\"\n          onClick={() => this.onSendMessage('mimi8', 2)}\n        />\n        <img\n          className=\"imgSticker\"\n          src={images.mimi9}\n          alt=\"sticker\"\n          onClick={() => this.onSendMessage('mimi9', 2)}\n        />\n      </div>\n    )\n  }\n\n  hashString = str => {\n    let hash = 0\n    for (let i = 0; i < str.length; i++) {\n      hash += Math.pow(str.charCodeAt(i) * 31, str.length - i)\n      hash = hash & hash // Convert to 32bit integer\n    }\n    return hash\n  }\n\n  getGifImage = value => {\n    switch (value) {\n      case 'mimi1':\n        return images.mimi1\n      case 'mimi2':\n        return images.mimi2\n      case 'mimi3':\n        return images.mimi3\n      case 'mimi4':\n        return images.mimi4\n      case 'mimi5':\n        return images.mimi5\n      case 'mimi6':\n        return images.mimi6\n      case 'mimi7':\n        return images.mimi7\n      case 'mimi8':\n        return images.mimi8\n      case 'mimi9':\n        return images.mimi9\n      default:\n        return null\n    }\n  }\n\n  isLastMessageLeft(index) {\n    if (\n      (index + 1 < this.listMessage.length &&\n        this.listMessage[index + 1].idFrom === this.currentUserId) ||\n      index === this.listMessage.length - 1\n    ) {\n      return true\n    } else {\n      return false\n    }\n  }\n\n  isLastMessageRight(index) {\n    if (\n      (index + 1 < this.listMessage.length &&\n        this.listMessage[index + 1].idFrom !== this.currentUserId) ||\n      index === this.listMessage.length - 1\n    ) {\n      return true\n    } else {\n      return false\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"module"}